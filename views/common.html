{{ block "header" . }}
<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href="/static/css/daisyui.css" rel="stylesheet" type="text/css" />
		<script src="/static/js/tailwind.js"></script>
	</head>
	<body>
		<div class="header">
			<div class="navbar bg-base-200">
				<div class="flex-1 ml-5 mr-5">
					<a href="/" class="btn btn-ghost text-xl">киноDB</a>
				</div>
				{{ if .IsUserAuthenticated }}
				{{ with .User }}
				<div class="flex-none dropdown dropdown-end mr-5">
					<div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar">
						<div class="w-10 rounded-full">
							<img alt="Avatar" src="/static/images/avatar.jpg" />
						</div>
					</div>
					<ul tabindex="0" class="mt-3 z-[1] p-2 shadow menu menu-sm dropdown-content bg-base-100 rounded-box w-52">
						<li>
							<a class="justify-between">
								Ваш профиль: {{ .Username }}
							</a>
						</li>
						<li><a href="/logout">Выйти</a></li>
					</ul>
				</div>
				{{ end }}
				{{ else }}
				<a class="btn btn-outline mr-5" href="/signup">Вход/Регистрация</a>
				{{ end }}
			</div>
		</div>


{{ end }}

{{ block "search" . }}
		<form id="form-search">
		<div>
			<label class="mt-5 ml-10 mr-10 input input-bordered flex items-center">
				<input type="text" name="title_title" class="grow" placeholder="Поиск..." />
				<button type="submit" class="btn btn-primary">
					<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4 opacity-70"><path fill-rule="evenodd" d="M9.965 11.026a5 5 0 1 1 1.06-1.06l2.755 2.754a.75.75 0 1 1-1.06 1.06l-2.755-2.754ZM10.5 7a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Z" clip-rule="evenodd" /></svg>
				</button>
			</label>
		</div>

		<div class="flex flex-row flex-wrap mt-5 gap-x-4 ml-10">
			<label class="form-control">
				<div class="label">
					<span class="label-text">Тип контента</span>
				</div>
				<select name="type_char" class="select select-bordered">
					<option value="all" >Всё</option>
					<option value="a" >Фильмы</option>
					<option value="d">Сериалы</option>
					<option value="f">Мультсериалы</option>
					<option value="c">Полнометражные мультфильмы</option>
					<option value="e">Аниме сериалы</option>
					<option value="b">Полнометражные аниме</option>
				</select>
			</label>
			<label class="form-control">
				<div class="label">
					<span class="label-text">Сортировать по</span>
				</div>
				<select name="order_by" class="select select-bordered">
					<option value="rating_avg">Рейтингу</option>
					<option value="rating_cnt">Количеству оценок</option>
					<option value="title">Названию</option>
				</select>
			</label>

			<label class="form-control">
				<div class="label">
					<span class="label-text">Отфильтровать по жанрам</span>
				</div>
				<label class="input input-bordered flex items-center">
					<input name="genre" type="text" />
				</label>
			</label>
		</div>
		</form>
{{ end }}

{{ block "footer" . }}
		<div class="mt-20">
		</div>
	</body>
	{{ template "rating_script" . }}
</html>

{{ end }}
{{ block "rating_script" . }}
<script>
{{ if .Review }}
document.reviewRating.rating[{{ .Review.Value }} - 1 ].checked = true
{{ end }}

var formSearch = document.getElementById('form-search')
if (formSearch != null) {
	const queryString = window.location.search;
	const urlParams = new URLSearchParams(queryString);
	if (urlParams.has('title_title')) {
		formSearch.title_title.value = urlParams.get('title_title')
	}
	if (urlParams.has('type_char')) {
		formSearch.type_char.value = urlParams.get('type_char')
	}
	if (urlParams.has('order_by')) {
		formSearch.order_by.value = urlParams.get('order_by')
	}
	if (urlParams.has('genre')) {
		formSearch.genre.value = urlParams.get('genre')
	}
}

var formRating = document.getElementById('form-review-rating')
if (formRating != null) {
	var stars = formRating.rating
	for (var i = 0; i < stars.length; i++) {
		stars[i].addEventListener('change', function() {
			document.getElementById('rating-number').textContent = this.value
		});
	}
}

function validateReviewForm() {
	let reviewTitle = formRating["review_title"].value.trim()
	let review = formRating["review"].value.trim()

	if ((reviewTitle == "" && review != "") ||
            (review == "" && reviewTitle != "")) {
		let formValidationError = document.getElementById("form-validation-error")
		formValidationError.removeAttribute("hidden")

		return false
	}

	return true
}
</script>
{{ end }}
